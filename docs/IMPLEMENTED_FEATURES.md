# SlimeVR CH59X 已实现功能 / Implemented Features

**版本**: 0.4.13  
**更新日期**: 2026-01-20

---

## 1. 传感器系统 / Sensor System

### 1.1 IMU 支持 (9种型号)

| IMU型号 | 状态 | 特点 |
|---------|------|------|
| ICM-45686 | ✅ 完整 | TDK旗舰, 推荐 |
| ICM-42688 | ✅ 完整 | TDK高性能 |
| IIM-42652 | ✅ 完整 | TDK工业级 (-40°C~+105°C) |
| BMI270 | ✅ 完整 | Bosch低功耗, 推荐 |
| BMI323 | ✅ 完整 | Bosch新款 |
| LSM6DSV | ✅ 完整 | ST高精度, 媲美BNO085 |
| LSM6DSR | ✅ 完整 | ST标准型 |
| LSM6DSO | ✅ 完整 | ST常用型 |
| SC7I22 | ✅ 完整 | 国产低成本 |

**功能**:
- 自动检测 (SPI优先, 回退I2C)
- 可配置采样率 (25Hz~8kHz)
- 可配置量程 (陀螺仪/加速度)
- DMA + 中断驱动
- FIFO支持
- 温度读取

### 1.2 磁力计支持 (4种型号)

| 磁力计型号 | 状态 | 特点 |
|------------|------|------|
| QMC5883P | ✅ 完整 | 国产高性价比 |
| HMC5883L | ✅ 完整 | 经典型号 |
| HMC5983 | ✅ 完整 | 温度补偿版 |
| IIS2MDC | ✅ 完整 | ST高精度 |

**功能**:
- 自动检测
- 默认禁用 (需手动启用)
- IMU为主, 磁力计辅助修正
- 偏差过大自动禁用
- 硬铁/软铁校准
- 航向输出

### 1.3 传感器融合

| 算法 | 状态 | 特点 |
|------|------|------|
| VQF | ✅ 默认 | 低功耗, 适合大多数场景 |
| EKF | ✅ 可选 | 高精度, 更好的偏差估计 |

**功能**:
- 四元数输出
- 欧拉角转换
- 重力分离
- 线性加速度

---

## 2. RF通信系统 / RF Communication

### 2.1 私有协议

| 功能 | 状态 | 说明 |
|------|------|------|
| 2.4GHz通信 | ✅ | 使用BLE物理层 |
| 2Mbps数据率 | ✅ | 高带宽 |
| 信道跳频 | ✅ | 5个信道 |
| TDMA时隙 | ✅ | 最多16个Tracker |
| ACK响应 | ✅ | 可靠传输 |
| 自动重传 | ✅ | 最多2次 |

### 2.2 时隙优化

| 指标 | 目标 | 当前状态 |
|------|------|----------|
| 延迟 | <5ms | ✅ 已优化 |
| 利用率 | >80% | ✅ 动态调整 |
| 吞吐量 | 200Hz | ✅ 支持 |

**功能**:
- 动态时隙分配
- 优先级调度
- 自适应时隙长度
- 预传输准备
- 批量传输优化

---

## 3. USB系统 / USB System

### 3.1 USB HID

| 功能 | 状态 | 说明 |
|------|------|------|
| SlimeVR协议 | ✅ | 兼容官方 |
| 多Tracker捆绑 | ✅ | 最多4个 |
| 命令接收 | ✅ | 配置/校准 |

### 3.2 USB Bootloader

| 功能 | 状态 | 说明 |
|------|------|------|
| MSC模式 | ✅ | 拖放更新 |
| UF2支持 | ✅ | 标准格式 |
| DFU触发 | ✅ | 按键进入 |

### 3.3 USB调试

| 功能 | 状态 | 说明 |
|------|------|------|
| 实时数据流 | ✅ | 四元数/传感器/温度 |
| 状态查询 | ✅ | 版本/配置/统计 |
| 配置修改 | ✅ | 运行时配置 |
| 诊断命令 | ✅ | 校准/重置/调试 |

**调试命令**:
```
0x01 PING
0x02 GET_VERSION
0x03 GET_STATUS
0x10 GET_SENSORS
0x11 GET_QUAT
0x20 CALIBRATE
0x30 STREAM_START
0x31 STREAM_STOP
0x40 MAG_ENABLE
0x41 MAG_DISABLE
```

---

## 4. 电源管理 / Power Management

### 4.1 功耗预算

| 组件 | 活动 (mA) | 优化后 (mA) |
|------|-----------|-------------|
| MCU (60MHz) | 8.0 | 6.0 (降频) |
| MCU (32MHz) | 4.5 | 4.5 |
| RF TX (+4dBm) | 12.5 | 9.0 (0dBm) |
| RF 平均 | 3.0 | 1.2 (10%占空比) |
| IMU (200Hz) | 0.65 | 0.4 (100Hz) |
| LED | 5.0 | 1.0 (PWM) |
| **总计** | **17.7** | **<20** |

### 4.2 睡眠模式

| 模式 | 功耗 | 唤醒时间 |
|------|------|----------|
| IDLE | ~8mA | <1μs |
| HALT | ~2mA | ~10μs |
| SHUTDOWN | <100μA | 需复位 |

### 4.3 智能调度

- 运动检测自动升降频
- 空闲超时自动睡眠
- 低电量强制省电模式
- RF占空比动态调整

---

## 5. 校准系统 / Calibration

### 5.1 自动校准

| 功能 | 状态 | 说明 |
|------|------|------|
| 静止检测 | ✅ | 陀螺仪+加速度 |
| 陀螺仪偏移 | ✅ | 静止时校准 |
| 漂移补偿 | ✅ | 运动中持续 |
| 加速度缩放 | ✅ | 重力校准 |
| 磁力计融合 | ✅ | 航向修正 |

### 5.2 温度补偿

| 功能 | 状态 | 说明 |
|------|------|------|
| 温度测量 | ✅ | IMU内置 |
| 多项式补偿 | ✅ | 二次模型 |
| 自适应学习 | ✅ | 持续优化 |
| 系数保存 | ✅ | Flash存储 |

---

## 6. OTA更新 / OTA Update

| 功能 | 状态 | 说明 |
|------|------|------|
| RF接收 | ⚠️ 可选 | 需启用编译 |
| CRC校验 | ✅ | 完整性验证 |
| 双分区 | ✅ | 安全更新 |
| 回滚保护 | ✅ | 失败恢复 |

**启用方法**: `make OTA=1`

---

## 7. 硬件优化 / Hardware Optimization

### 7.1 DMA传输

| 接口 | 状态 | 优化效果 |
|------|------|----------|
| SPI DMA | ✅ | 延迟 <1ms |
| I2C DMA | ✅ | 延迟 <2ms |
| 双缓冲 | ✅ | 零拷贝 |

### 7.2 内存优化

| 项目 | 目标 | 状态 |
|------|------|------|
| RAM | 6KB | ✅ 已优化 |
| Flash | <64KB | ✅ LTO优化 |
| Stack | <2KB | ✅ 静态分析 |

---

## 8. 兼容性 / Compatibility

### 8.1 芯片支持

| 芯片 | Flash | RAM | 状态 |
|------|-------|-----|------|
| CH592 | 448KB | 26KB | ✅ 完整 |
| CH591 | 256KB | 18KB | ✅ 完整 |

### 8.2 协议兼容

| 协议 | 状态 | 说明 |
|------|------|------|
| SlimeVR | ✅ | 官方兼容 |
| nRF52 Receiver | ✅ | 私有协议 |

---

## 9. 待实现功能 / Pending Features

| 功能 | 优先级 | 说明 |
|------|--------|------|
| BLE模式 | 中 | 替代私有RF |
| 多Receiver | 低 | 扩展覆盖 |
| 串口调试 | 低 | UART输出 |
| 手势识别 | 低 | 特定动作触发 |

---

## 10. 性能指标 / Performance Metrics

| 指标 | 目标 | 实际 |
|------|------|------|
| 传感器延迟 | <3ms | ✅ ~2ms |
| RF延迟 | <5ms | ✅ ~4ms |
| 功耗 | <20mA | ✅ ~15mA |
| RAM | 6KB | ✅ 5.8KB |
| 采样率 | 200Hz | ✅ 200Hz |
| Tracker数量 | 16 | ✅ 16 |

---

*文档版本: 0.4.13*
