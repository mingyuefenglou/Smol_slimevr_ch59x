# SlimeVR CH59X 测试与错误报告指南
# SlimeVR CH59X Testing and Bug Reporting Guide

## 概述

本指南介绍如何测试 SlimeVR CH59X 固件以及如何提交有效的错误报告。遵循本指南可以帮助快速定位和修复问题。

---

## 第一部分: 测试方法

### 1. 基础功能测试

#### 1.1 固件烧录测试

**测试步骤:**
1. 按住 BOOT 按键，插入 USB
2. 确认电脑识别出 "NIMISLIME" U盘
3. 拖放 tracker.uf2 到 U盘
4. 确认设备自动重启，LED 亮起

**预期结果:**
- U盘正常挂载
- 烧录完成后自动重启
- LED 指示灯亮起

**可能问题:**
| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| U盘未出现 | BOOT 按键未按下 | 确保按住 BOOT 再插入 USB |
| 烧录失败 | 文件损坏 | 重新下载固件 |
| 重启后无反应 | 固件不兼容 | 使用正确芯片版本的固件 |

#### 1.2 LED 指示灯测试

**测试步骤:**
1. 开机，观察 LED
2. 长按 3 秒，进入休眠
3. 短按唤醒
4. 双击进入配对模式

**预期结果:**
| 操作 | LED 状态 |
|------|----------|
| 开机 | 常亮 |
| 休眠 | 熄灭 |
| 配对 | 快闪 (2Hz) |
| 配对成功 | 闪烁 3 次 |

#### 1.3 按键功能测试

**测试步骤:**
1. 短按 SW1: 开机/唤醒
2. 长按 3 秒: 休眠
3. 双击: 配对模式
4. 按住 BOOT + 插入 USB: Bootloader 模式

### 2. 传感器测试

#### 2.1 IMU 初始化测试

**测试方法:**
使用调试输出或观察 LED 状态确认 IMU 初始化成功。

**预期结果:**
- WHO_AM_I 寄存器返回正确值
- 无初始化错误

**IMU 识别码:**
| IMU 型号 | WHO_AM_I |
|----------|----------|
| ICM-45686 | 0xE9 |
| ICM-42688 | 0x47 |
| BMI270 | 0x24 |
| LSM6DSV | 0x70 |
| LSM6DSR | 0x6B |

#### 2.2 陀螺仪噪声测试

**测试步骤:**
1. 将追踪器放置在稳定平面上
2. 静置 30 秒
3. 记录陀螺仪输出

**预期结果:**
- 静止时输出接近 0
- 噪声 < 0.01°/s (RMS)
- 无明显漂移

**测试代码示例:**
```c
// 在 main_tracker.c 中添加测试代码
float gyro[3], accel[3];
for (int i = 0; i < 1000; i++) {
    imu_read_all(gyro, accel);
    printf("Gyro: %.4f, %.4f, %.4f\n", gyro[0], gyro[1], gyro[2]);
    hal_delay_ms(5);
}
```

#### 2.3 加速度计测试

**测试步骤:**
1. 将追踪器水平放置，Z 轴朝上
2. 读取加速度计数据
3. 翻转追踪器，Z 轴朝下
4. 再次读取

**预期结果:**
- Z 朝上: accel_z ≈ +1.0g
- Z 朝下: accel_z ≈ -1.0g
- 误差 < ±0.05g

### 3. RF 通信测试

#### 3.1 配对测试

**测试步骤:**
1. 插入接收器到电脑
2. 追踪器双击进入配对模式
3. 等待配对完成

**预期结果:**
- 配对时间 < 10 秒
- 配对成功后 LED 闪烁 3 次

#### 3.2 距离测试

**测试步骤:**
1. 在不同距离测试通信
2. 记录丢包率

**预期结果 (无遮挡):**
| 距离 | 丢包率 |
|------|--------|
| 1m | < 0.1% |
| 5m | < 1% |
| 10m | < 5% |
| 15m | < 10% |

#### 3.3 干扰测试

**测试步骤:**
1. 在 WiFi 路由器附近测试
2. 开启蓝牙设备测试

**预期结果:**
- 跳频机制应能抵抗一定干扰
- 丢包率增加但仍可用

### 4. USB 连接测试

#### 4.1 接收器识别测试

**测试步骤:**
1. 插入接收器
2. 检查设备管理器

**Windows:**
```powershell
Get-PnpDevice | Where-Object { $_.InstanceId -like "*VID_1209*" }
```

**Linux:**
```bash
lsusb | grep 1209
```

**预期结果:**
- 设备识别为 HID 设备
- VID: 1209, PID: 7690

#### 4.2 数据传输测试

**测试步骤:**
1. 连接接收器
2. 启动 SlimeVR 软件
3. 开启追踪器
4. 观察数据更新

**预期结果:**
- 数据更新频率 ≈ 200Hz
- 无明显延迟 (< 10ms)

### 5. 电池测试

#### 5.1 电量检测测试

**测试步骤:**
1. 测量实际电池电压
2. 与软件显示值比较

**预期结果:**
- 误差 < ±0.1V
- 百分比估算合理

#### 5.2 续航测试

**测试步骤:**
1. 充满电池
2. 持续使用直到自动关机
3. 记录使用时间

**预期结果 (150mAh 电池):**
- 续航 > 10 小时

### 6. 精度测试

#### 6.1 静态精度测试

**测试步骤:**
1. 将追踪器放置在已知角度
2. 等待稳定 (10 秒)
3. 记录姿态输出

**预期结果:**
- 俯仰/滚转误差 < 1°
- 偏航会缓慢漂移 (无磁力计时)

#### 6.2 动态精度测试

**测试步骤:**
1. 将追踪器绑在可控旋转台上
2. 以已知角度旋转
3. 比较输出与实际角度

**预期结果:**
- 动态误差 < 3°
- 快速运动后能恢复

---

## 第二部分: 错误报告

### 1. 报告渠道

**GitHub Issues (推荐):**
- 地址: https://github.com/[your-repo]/issues
- 适合: 技术问题、功能请求、代码错误

**SlimeVR Discord:**
- 频道: #support-forum 或 #technical-support
- 适合: 快速问题、使用帮助

### 2. 错误报告模板

请复制以下模板并填写:

```markdown
## 错误描述
[简要描述问题]

## 复现步骤
1. [第一步]
2. [第二步]
3. [第三步]

## 预期行为
[应该发生什么]

## 实际行为
[实际发生了什么]

## 环境信息
- 固件版本: v0.7.2
- 芯片型号: CH591D / CH592
- IMU 型号: ICM-45686 / BMI270 / LSM6DSV
- 操作系统: Windows 11 / Linux / macOS
- SlimeVR Server 版本: [版本号]

## 日志输出
[如果有的话，粘贴相关日志]

## 截图
[如果有帮助的话，附上截图]

## 其他信息
[任何其他相关信息]
```

### 3. 收集调试信息

#### 3.1 获取固件版本

查看 VERSION 文件或在启动时输出。

#### 3.2 获取日志

**方法 1: USB CDC (如果启用)**
```bash
# Linux
screen /dev/ttyACM0 115200

# Windows
使用 PuTTY 或类似工具
```

**方法 2: 调试 LED 闪烁**
记录 LED 闪烁模式。

#### 3.3 获取系统日志

**Windows:**
```powershell
Get-EventLog -LogName System -Newest 50 | Where-Object { $_.Message -like "*USB*" }
```

**Linux:**
```bash
dmesg | grep -i usb | tail -20
journalctl -xe | grep -i slime
```

### 4. 常见问题自查

在报告前，请先检查:

**追踪器不工作:**
- [ ] 电池是否充电
- [ ] 固件是否正确烧录
- [ ] IMU 是否正确连接

**配对失败:**
- [ ] 接收器是否插好
- [ ] 距离是否过远
- [ ] 是否有强干扰源

**数据漂移:**
- [ ] 是否静置校准
- [ ] 温度是否稳定
- [ ] IMU 是否固定牢固

**USB 不识别:**
- [ ] 数据线是否支持数据传输
- [ ] USB 端口是否正常
- [ ] 驱动是否安装

### 5. 提交有效报告的技巧

**做到:**
- 提供具体的复现步骤
- 包含环境信息
- 附上相关日志和截图
- 一个问题一个 Issue

**避免:**
- 描述模糊 ("不工作")
- 缺少环境信息
- 多个不相关问题混在一起
- 不尝试自查就报告

---

## 第三部分: 开发者调试

### 1. 启用调试输出

编辑 `include/config.h`:

```c
#define DEBUG_ENABLE            // 启用调试
#define DEBUG_UART              // 使用 UART 输出
// #define DEBUG_USB            // 或使用 USB CDC
```

### 2. 使用 GDB 调试

```bash
# 连接 WCH-Link
riscv-none-elf-gdb tracker.elf

# 在 GDB 中
(gdb) target remote localhost:3333
(gdb) monitor reset halt
(gdb) break main
(gdb) continue
```

### 3. 性能分析

使用 GPIO 翻转测量执行时间:

```c
GPIOA_SetBits(GPIO_Pin_8);   // 开始
// ... 被测代码 ...
GPIOA_ResetBits(GPIO_Pin_8); // 结束
```

用示波器测量脉冲宽度。

---

*最后更新: 2026-01-12*
